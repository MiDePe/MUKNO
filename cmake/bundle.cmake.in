include(BundleUtilities)

set(ApplicationList "$<TARGET_PROPERTY:BUNDLE,APPLICATION_LIST>")
set(LookupDirectories "C:/thesis/SDK-gris/x64/release/qcustomplot-1.3.2/bin;C:/thesis/SDK-gris/x64/release/boost_1_59_0/lib64-msvc-14.0;C:/thesis/SDK-gris/x64/release/gmp/lib/;C:/thesis/build/x64/release/MUKNO2-gris/$<CONFIG>/bin/;C:/thesis/SDK-gris/x64/release/GrisFramework-0.6.2/bin;$<TARGET_FILE_DIR:gstd>;$<TARGET_FILE_DIR:Boost::filesystem>;$<TARGET_FILE_DIR:Boost::system>;C:/thesis/SDK-gris/x64/release/GDCM/bin;$<TARGET_FILE_DIR:gdcmDICT>;$<TARGET_FILE_DIR:gdcmMSFF>;C:/thesis/SDK-gris/x64/release/VTK-7.1.1/bin;$<TARGET_FILE_DIR:vtkChartsCore>;$<TARGET_FILE_DIR:vtkCommonCore>;$<TARGET_FILE_DIR:vtkCommonDataModel>;$<TARGET_FILE_DIR:vtkCommonMath>;$<TARGET_FILE_DIR:vtkCommonTransforms>;$<TARGET_FILE_DIR:vtkFiltersGeneral>;$<TARGET_FILE_DIR:vtkCommonExecutionModel>;$<TARGET_FILE_DIR:vtkCommonMisc>;$<TARGET_FILE_DIR:vtkFiltersCore>;$<TARGET_FILE_DIR:vtkRenderingContext2D>;$<TARGET_FILE_DIR:vtkRenderingCore>;$<TARGET_FILE_DIR:vtksys>;$<TARGET_FILE_DIR:vtkCommonColor>;$<TARGET_FILE_DIR:vtkCommonSystem>;$<TARGET_FILE_DIR:vtkCommonComputationalGeometry>;$<TARGET_FILE_DIR:vtkInfovisCore>;$<TARGET_FILE_DIR:vtkFiltersExtraction>;$<TARGET_FILE_DIR:vtkFiltersStatistics>;$<TARGET_FILE_DIR:vtkalglib>;$<TARGET_FILE_DIR:vtkImagingFourier>;$<TARGET_FILE_DIR:vtkImagingCore>;$<TARGET_FILE_DIR:vtkFiltersGeometry>;$<TARGET_FILE_DIR:vtkFiltersSources>;$<TARGET_FILE_DIR:vtkRenderingFreeType>;$<TARGET_FILE_DIR:vtkfreetype>;$<TARGET_FILE_DIR:vtkzlib>;$<TARGET_FILE_DIR:vtkDICOMParser>;$<TARGET_FILE_DIR:vtkDomainsChemistry>;$<TARGET_FILE_DIR:vtkIOLegacy>;$<TARGET_FILE_DIR:vtkIOCore>;$<TARGET_FILE_DIR:vtkIOXMLParser>;$<TARGET_FILE_DIR:vtkexpat>;$<TARGET_FILE_DIR:vtkFiltersAMR>;$<TARGET_FILE_DIR:vtkIOXML>;$<TARGET_FILE_DIR:vtkParallelCore>;$<TARGET_FILE_DIR:vtkFiltersFlowPaths>;$<TARGET_FILE_DIR:vtkFiltersGeneric>;$<TARGET_FILE_DIR:vtkFiltersHybrid>;$<TARGET_FILE_DIR:vtkImagingSources>;$<TARGET_FILE_DIR:vtkFiltersHyperTree>;$<TARGET_FILE_DIR:vtkFiltersImaging>;$<TARGET_FILE_DIR:vtkImagingGeneral>;$<TARGET_FILE_DIR:vtkFiltersModeling>;$<TARGET_FILE_DIR:vtkFiltersParallel>;$<TARGET_FILE_DIR:vtkFiltersParallelImaging>;$<TARGET_FILE_DIR:vtkFiltersPoints>;$<TARGET_FILE_DIR:vtkFiltersProgrammable>;$<TARGET_FILE_DIR:vtkFiltersSMP>;$<TARGET_FILE_DIR:vtkFiltersSelection>;$<TARGET_FILE_DIR:vtkFiltersTexture>;$<TARGET_FILE_DIR:vtkFiltersVerdict>;$<TARGET_FILE_DIR:verdict>;$<TARGET_FILE_DIR:vtkGUISupportQt>;$<TARGET_FILE_DIR:vtkRenderingOpenGL>;C:/thesis/SDK-gris/x64/release/qt-5.7/5.7/msvc2015_64/bin;$<TARGET_FILE_DIR:Qt5::Widgets>;$<TARGET_FILE_DIR:Qt5::Gui>;$<TARGET_FILE_DIR:Qt5::Core>;$<TARGET_FILE_DIR:vtkInteractionStyle>;$<TARGET_FILE_DIR:vtkIOImage>;$<TARGET_FILE_DIR:vtkmetaio>;$<TARGET_FILE_DIR:vtkjpeg>;$<TARGET_FILE_DIR:vtkpng>;$<TARGET_FILE_DIR:vtktiff>;$<TARGET_FILE_DIR:vtkImagingHybrid>;$<TARGET_FILE_DIR:vtkGUISupportQtOpenGL>;$<TARGET_FILE_DIR:vtkGUISupportQtSQL>;$<TARGET_FILE_DIR:vtkIOSQL>;$<TARGET_FILE_DIR:vtkGeovisCore>;$<TARGET_FILE_DIR:vtkInteractionWidgets>;$<TARGET_FILE_DIR:vtkViewsCore>;$<TARGET_FILE_DIR:vtkproj4>;$<TARGET_FILE_DIR:vtkInfovisLayout>;$<TARGET_FILE_DIR:vtkImagingColor>;$<TARGET_FILE_DIR:vtkRenderingAnnotation>;$<TARGET_FILE_DIR:vtkRenderingVolume>;$<TARGET_FILE_DIR:vtkIOAMR>;$<TARGET_FILE_DIR:vtkhdf5_hl>;$<TARGET_FILE_DIR:vtkhdf5>;$<TARGET_FILE_DIR:vtkIOEnSight>;$<TARGET_FILE_DIR:vtkIOExodus>;$<TARGET_FILE_DIR:vtkexoIIc>;$<TARGET_FILE_DIR:vtkNetCDF>;$<TARGET_FILE_DIR:vtkNetCDF_cxx>;$<TARGET_FILE_DIR:vtkIOExport>;$<TARGET_FILE_DIR:vtkRenderingGL2PS>;$<TARGET_FILE_DIR:vtkRenderingContextOpenGL>;$<TARGET_FILE_DIR:vtkgl2ps>;$<TARGET_FILE_DIR:vtkIOGeometry>;$<TARGET_FILE_DIR:vtkIOImport>;$<TARGET_FILE_DIR:vtkIOInfovis>;$<TARGET_FILE_DIR:vtklibxml2>;$<TARGET_FILE_DIR:vtkIOLSDyna>;$<TARGET_FILE_DIR:vtkIOMINC>;$<TARGET_FILE_DIR:vtkIOMovie>;$<TARGET_FILE_DIR:vtkoggtheora>;$<TARGET_FILE_DIR:vtkIONetCDF>;$<TARGET_FILE_DIR:vtkIOPLY>;$<TARGET_FILE_DIR:vtkIOParallel>;$<TARGET_FILE_DIR:vtkjsoncpp>;$<TARGET_FILE_DIR:vtkIOParallelXML>;$<TARGET_FILE_DIR:vtkIOTecplotTable>;$<TARGET_FILE_DIR:vtkIOVideo>;$<TARGET_FILE_DIR:vtkImagingMath>;$<TARGET_FILE_DIR:vtkImagingMorphological>;$<TARGET_FILE_DIR:vtkImagingStatistics>;$<TARGET_FILE_DIR:vtkImagingStencil>;$<TARGET_FILE_DIR:vtkInteractionImage>;$<TARGET_FILE_DIR:vtkRenderingImage>;$<TARGET_FILE_DIR:vtkRenderingLIC>;$<TARGET_FILE_DIR:vtkRenderingLOD>;$<TARGET_FILE_DIR:vtkRenderingLabel>;$<TARGET_FILE_DIR:vtkRenderingQt>;$<TARGET_FILE_DIR:vtkRenderingVolumeOpenGL>;$<TARGET_FILE_DIR:vtkViewsContext2D>;$<TARGET_FILE_DIR:vtkViewsInfovis>;$<TARGET_FILE_DIR:vtkViewsQt>;$<TARGET_FILE_DIR:Boost::chrono>;$<TARGET_FILE_DIR:Boost::date_time>;$<TARGET_FILE_DIR:Boost::program_options>;$<TARGET_FILE_DIR:Boost::regex>;$<TARGET_FILE_DIR:Boost::serialization>;$<TARGET_FILE_DIR:Boost::thread>;$<TARGET_FILE_DIR:Boost::atomic>;$<TARGET_FILE_DIR:Boost::unit_test_framework>;C:/thesis/SDK-gris/x64/release/ACVD_vtk-7.1.1/lib/cmake/ACVD/../../../bin;$<TARGET_FILE_DIR:vtkDiscreteRemeshing>;$<TARGET_FILE_DIR:vtkSurface>;$<TARGET_FILE_DIR:vtkVolumeProcessing>;$<TARGET_FILE_DIR:Qt5::PrintSupport>" "$<TARGET_PROPERTY:BUNDLE,LOOKUP_DIRECTORIES_$<UPPER_CASE:$<CONFIG>>>")

list(REMOVE_DUPLICATES LookupDirectories)


set(MuknoPlanner_file "C:/thesis/build/x64/release/MUKNO2-gris/$<CONFIG>/bin/$<TARGET_FILE_NAME:MuknoPlanner>")


foreach(app IN LISTS ApplicationList)
  if(NOT DEFINED ${app}_dynamic_libs)
    set(${app}_dynamic_libs "")
  endif()
  fixup_bundle("${${app}_file}" "${${app}_dynamic_libs}" "${LookupDirectories}")
  get_filename_component(TARGET_DIRECTORY "${${app}_file}" PATH)
  get_bundle_and_executable("${${app}_file}" bundle executable valid)

  # copy pdbs, if they exist
  IF(valid)
    get_bundle_keys("${${app}_file}" "${${app}_dynamic_libs}" "${LookupDirectories}" keys)
    FOREACH(key ${keys})
      IF(${key}_RESOLVED_ITEM MATCHES "\\.[Dd][Ll][Ll]$")
        string(LENGTH ${key}_RESOLVED_ITEM length)
        MATH(EXPR length "${length} - 4")
        string(SUBSTRING "${${key}_RESOLVED_ITEM}" 0 ${length} filename)
        SET(filename "${filename}.pdb")
        IF(EXISTS "${filename}")
          FILE(COPY ${filename} DESTINATION ${TARGET_DIRECTORY})
        ENDIF()
      ENDIF()
    ENDFOREACH()
  ENDIF(valid)
endforeach()
